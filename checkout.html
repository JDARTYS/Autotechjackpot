<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout - AutoTechJackpot</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://js.stripe.com/v3/"></script> <!-- Stripe Library -->
</head>
<body>
  <header>
    <div class="header-container">
      <div class="logo">
        <a href="index.html">AutoTechJackpot</a>
      </div>
      <nav>
      <a href="how-it-works.html" aria-label="How it Works">How It Works</a>
        <a href="winners.html" aria-label="View Winners">Winners</a>
        <a href="tickets.html" aria-label="View Tickets" class="active">Tickets</a>
        <a href="cart.html" aria-label="View Cart">Cart</a>
        <a href="login.html" aria-label="Login or Register">Login / Register</a>
        <a href="activecompetitions.html" aria-label="Active Competitions">Active Competitions</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="checkout">
      <h1>Checkout</h1>
      <p>Review your order and proceed to payment.</p>

      <!-- Order Details -->
      <div class="order-summary" id="order-summary">
        <!-- Order items will be dynamically added here -->
      </div>

      <!-- Payment Section -->
      <div class="payment-section">
        <h2>Choose Your Payment Method</h2>
       <!-- Bottone PayPal -->
<a id="paypal-button" href="#" class="payment-button paypal">Pay with PayPal</a>

<!-- Bottone Credit Card -->
<button id="card-button" class="payment-button card">Pay with Credit Card</button>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 AutoTechJackpot. All rights reserved.</p>
    <nav>
      <a href="policy.html">Terms & Policy</a>
    </nav>
  </footer>

  <script>
    const stripe = Stripe('pk_live_51QgpeAFR0CD3L4eTZzZS5p8MpE1Krtjk0bdQB00pFc1eS90wVDLkO0MFcpG6ATrM7mwixQIML7PyS0DAtwa7TjsB00ytBk4wwf'); // Replace with your Stripe publishable key

    // Funzione per calcolare totale e dettagli ordine
    function calculateTotal(cart) {
      let total = 0;
      let orderDetails = '';

      cart.forEach(item => {
        const price = parseFloat(item.price) || 0;
        const quantity = item.quantity || 1;

        total += price * quantity;

        orderDetails += `
          <div class="order-item">
            <p><strong>${item.name || "Unnamed Competition"}</strong></p>
            <p>Price: €${price.toFixed(2)} x ${quantity}</p>
          </div>
        `;
      });

      return { total: total.toFixed(2), orderDetails };
    }

    document.addEventListener('DOMContentLoaded', () => {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const orderSummary = document.getElementById('order-summary');
      const paypalButton = document.getElementById('paypal-button');
      const creditCardButton = document.getElementById('credit-card-button');

      if (cart.length > 0) {
        const { total, orderDetails } = calculateTotal(cart);

        orderSummary.innerHTML = `
          ${orderDetails}
          <p class="order-total"><strong>Total Amount: €${total}</strong></p>
        `;

        // Configura PayPal link
        paypalButton.href = `https://paypal.me/autotechjackpot?amount=${total}`;

        // Stripe Payment for Credit Card
        creditCardButton.addEventListener('click', () => {
          stripe.redirectToCheckout({
            lineItems: cart.map(item => ({
              price_data: {
                currency: 'eur',
                product_data: { name: item.name },
                unit_amount: Math.round(item.price * 100),
              },
              quantity: item.quantity || 1,
            })),
            mode: 'payment',
            successUrl: window.location.origin + '/success.html',
            cancelUrl: window.location.origin + '/checkout.html',
          }).then(result => {
            if (result.error) {
              alert(result.error.message);
            }
          });
        });
      } else {
        orderSummary.innerHTML = '<p>Your cart is empty. Please add items to the cart.</p>';
        paypalButton.style.display = 'none'; // Nascondi PayPal
        creditCardButton.style.display = 'none'; // Nascondi Credit Card
      }
    });
  </script>
</body>
</html>
